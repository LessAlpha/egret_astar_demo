!function(t,o){"use strict";"function"==typeof define&&define.amd?define(o):"object"==typeof exports?module.exports=o():t.SAT=o()}(this,function(){"use strict";function t(t,o){this.x=t||0,this.y=o||0}function o(o,e){this.pos=o||new t,this.r=e||0}function e(o,e){this.pos=o||new t,this.angle=0,this.offset=new t,this.setPoints(e||[])}function r(o,e,r){this.pos=o||new t,this.w=e||0,this.h=r||0}function n(){this.a=null,this.b=null,this.overlapN=new t,this.overlapV=new t,this.clear()}function s(t,o,e){for(var r=Number.MAX_VALUE,n=-Number.MAX_VALUE,s=t.length,p=0;s>p;p++){var i=t[p].dot(o);r>i&&(r=i),i>n&&(n=i)}e[0]=r,e[1]=n}function p(t,o,e,r,n,p){var i=g.pop(),h=g.pop(),a=v.pop().copy(o).sub(t),u=a.dot(n);if(s(e,n,i),s(r,n,h),h[0]+=u,h[1]+=u,i[0]>h[1]||h[0]>i[1])return v.push(a),g.push(i),g.push(h),!0;if(p){var c=0;if(i[0]<h[0])if(p.aInB=!1,i[1]<h[1])c=i[1]-h[0],p.bInA=!1;else{var l=i[1]-h[0],y=h[1]-i[0];c=y>l?l:-y}else if(p.bInA=!1,i[1]>h[1])c=i[0]-h[1],p.aInB=!1;else{var l=i[1]-h[0],y=h[1]-i[0];c=y>l?l:-y}var f=Math.abs(c);f<p.overlap&&(p.overlap=f,p.overlapN.copy(n),0>c&&p.overlapN.reverse())}return v.push(a),g.push(i),g.push(h),!1}function i(t,o){var e=t.len2(),r=o.dot(t);return 0>r?A:r>e?P:d}function h(t,o){var e=v.pop().copy(t).sub(o.pos),r=o.r*o.r,n=e.len2();return v.push(e),r>=n}function a(t,o){w.pos.copy(t),b.clear();var e=y(w,o,b);return e&&(e=b.aInB),e}function u(t,o,e){var r=v.pop().copy(o.pos).sub(t.pos),n=t.r+o.r,s=n*n,p=r.len2();if(p>s)return v.push(r),!1;if(e){var i=Math.sqrt(p);e.a=t,e.b=o,e.overlap=n-i,e.overlapN.copy(r.normalize()),e.overlapV.copy(r).scale(e.overlap),e.aInB=t.r<=o.r&&i<=o.r-t.r,e.bInA=o.r<=t.r&&i<=t.r-o.r}return v.push(r),!0}function c(t,o,e){for(var r=v.pop().copy(o.pos).sub(t.pos),n=o.r,s=n*n,p=t.calcPoints,h=p.length,a=v.pop(),u=v.pop(),c=0;h>c;c++){var l=c===h-1?0:c+1,y=0===c?h-1:c-1,f=0,x=null;a.copy(t.edges[c]),u.copy(r).sub(p[c]),e&&u.len2()>s&&(e.aInB=!1);var g=i(a,u);if(g===A){a.copy(t.edges[y]);var b=v.pop().copy(r).sub(p[y]);if(g=i(a,b),g===P){var w=u.len();if(w>n)return v.push(r),v.push(a),v.push(u),v.push(b),!1;e&&(e.bInA=!1,x=u.normalize(),f=n-w)}v.push(b)}else if(g===P){if(a.copy(t.edges[l]),u.copy(r).sub(p[l]),g=i(a,u),g===A){var w=u.len();if(w>n)return v.push(r),v.push(a),v.push(u),!1;e&&(e.bInA=!1,x=u.normalize(),f=n-w)}}else{var d=a.perp().normalize(),w=u.dot(d),I=Math.abs(w);if(w>0&&I>n)return v.push(r),v.push(d),v.push(u),!1;e&&(x=d,f=n-w,(w>=0||2*n>f)&&(e.bInA=!1))}x&&e&&Math.abs(f)<Math.abs(e.overlap)&&(e.overlap=f,e.overlapN.copy(x))}return e&&(e.a=t,e.b=o,e.overlapV.copy(e.overlapN).scale(e.overlap)),v.push(r),v.push(a),v.push(u),!0}function l(t,o,e){var r=c(o,t,e);if(r&&e){var n=e.a,s=e.aInB;e.overlapN.reverse(),e.overlapV.reverse(),e.a=e.b,e.b=n,e.aInB=e.bInA,e.bInA=s}return r}function y(t,o,e){for(var r=t.calcPoints,n=r.length,s=o.calcPoints,i=s.length,h=0;n>h;h++)if(p(t.pos,o.pos,r,s,t.normals[h],e))return!1;for(var h=0;i>h;h++)if(p(t.pos,o.pos,r,s,o.normals[h],e))return!1;return e&&(e.a=t,e.b=o,e.overlapV.copy(e.overlapN).scale(e.overlap)),!0}var f={};f.Vector=t,f.V=t,t.prototype.test=10,t.prototype.copy=t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.clone=t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.perp=t.prototype.perp=function(){var t=this.x;return this.x=this.y,this.y=-t,this},t.prototype.rotate=t.prototype.rotate=function(t){var o=this.x,e=this.y;return this.x=o*Math.cos(t)-e*Math.sin(t),this.y=o*Math.sin(t)+e*Math.cos(t),this},t.prototype.reverse=t.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.normalize=t.prototype.normalize=function(){var t=this.len();return t>0&&(this.x=this.x/t,this.y=this.y/t),this},t.prototype.add=t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.sub=t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.scale=t.prototype.scale=function(t,o){return this.x*=t,this.y*=o||t,this},t.prototype.project=t.prototype.project=function(t){var o=this.dot(t)/t.len2();return this.x=o*t.x,this.y=o*t.y,this},t.prototype.projectN=t.prototype.projectN=function(t){var o=this.dot(t);return this.x=o*t.x,this.y=o*t.y,this},t.prototype.reflect=t.prototype.reflect=function(t){var o=this.x,e=this.y;return this.project(t).scale(2),this.x-=o,this.y-=e,this},t.prototype.reflectN=t.prototype.reflectN=function(t){var o=this.x,e=this.y;return this.projectN(t).scale(2),this.x-=o,this.y-=e,this},t.prototype.dot=t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.len2=t.prototype.len2=function(){return this.dot(this)},t.prototype.len=t.prototype.len=function(){return Math.sqrt(this.len2())},f.Circle=o,o.prototype.getAABB=o.prototype.getAABB=function(){var o=this.r,e=this.pos.clone().sub(new t(o,o));return new r(e,2*o,2*o).toPolygon()},f.Polygon=e,e.prototype.setPoints=e.prototype.setPoints=function(o){var e=!this.points||this.points.length!==o.length;if(e){var r,n=this.calcPoints=[],s=this.edges=[],p=this.normals=[];for(r=0;r<o.length;r++)n.push(new t),s.push(new t),p.push(new t)}return this.points=o,this._recalc(),this},e.prototype.setAngle=e.prototype.setAngle=function(t){return this.angle=t,this._recalc(),this},e.prototype.setOffset=e.prototype.setOffset=function(t){return this.offset=t,this._recalc(),this},e.prototype.rotate=e.prototype.rotate=function(t){for(var o=this.points,e=o.length,r=0;e>r;r++)o[r].rotate(t);return this._recalc(),this},e.prototype.translate=e.prototype.translate=function(t,o){for(var e=this.points,r=e.length,n=0;r>n;n++)e[n].x+=t,e[n].y+=o;return this._recalc(),this},e.prototype._recalc=function(){var t,o=this.calcPoints,e=this.edges,r=this.normals,n=this.points,s=this.offset,p=this.angle,i=n.length;for(t=0;i>t;t++){var h=o[t].copy(n[t]);h.x+=s.x,h.y+=s.y,0!==p&&h.rotate(p)}for(t=0;i>t;t++){var a=o[t],u=i-1>t?o[t+1]:o[0],c=e[t].copy(u).sub(a);r[t].copy(c).perp().normalize()}return this},e.prototype.getAABB=e.prototype.getAABB=function(){for(var o=this.calcPoints,e=o.length,n=o[0].x,s=o[0].y,p=o[0].x,i=o[0].y,h=1;e>h;h++){var a=o[h];a.x<n?n=a.x:a.x>p&&(p=a.x),a.y<s?s=a.y:a.y>i&&(i=a.y)}return new r(this.pos.clone().add(new t(n,s)),p-n,i-s).toPolygon()},f.Box=r,r.prototype.toPolygon=r.prototype.toPolygon=function(){var o=this.pos,r=this.w,n=this.h;return new e(new t(o.x,o.y),[new t,new t(r,0),new t(r,n),new t(0,n)])},f.Response=n,n.prototype.clear=n.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var v=[],x=0;10>x;x++)v.push(new t);for(var g=[],x=0;5>x;x++)g.push([]);var b=new n,w=new r(new t,1,1).toPolygon(),A=-1,d=0,P=1;return f.pointInCircle=h,f.pointInPolygon=a,f.testCircleCircle=u,f.testPolygonCircle=c,f.testCirclePolygon=l,f.testPolygonPolygon=y,f});